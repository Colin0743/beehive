# 视频和封面图片上传功能

## 功能概述

项目发起人在创建新的AI视频项目时，现在可以上传视频文件和封面图片，以更好地展示项目内容和吸引协作者。

## 新增功能

### 1. 封面图片上传（必填）
- **支持格式**: JPG, PNG, GIF
- **文件大小限制**: 最大 5MB
- **上传方式**: 点击上传或拖拽文件
- **预览功能**: 上传后立即显示预览
- **删除功能**: 可以删除已上传的图片重新选择

### 2. 视频文件上传（可选）
- **支持格式**: MP4, MOV, AVI
- **文件大小限制**: 最大 20MB（建议 <10MB）
- **上传方式**: 点击上传或拖拽文件
- **预览功能**: 上传后可以播放预览
- **删除功能**: 可以删除已上传的视频重新选择
- **智能警告**: 大文件上传前会提示用户确认

### 3. 项目展示
- **首页展示**: 项目卡片显示上传的封面图片
- **详情页展示**: 
  - 如果上传了视频，优先显示视频播放器（使用封面图片作为poster）
  - 如果只上传了封面图片，显示封面图片
  - 视频和图片以全宽度展示，最大高度为96（384px）

## 技术实现

### 数据存储
- 文件转换为 Base64 格式存储在 localStorage 中
- 项目数据结构新增字段：
  - `coverImage`: 封面图片的 Base64 字符串（压缩后）
  - `videoFile`: 视频文件的 Base64 字符串

### 图片压缩优化
- 自动压缩上传的图片：
  - 最大尺寸限制为 1200px
  - JPEG 压缩质量 0.7
  - 大幅减少存储空间占用

### 文件验证
- 文件类型验证：检查 MIME 类型
- 文件大小验证：
  - 图片：5MB 限制
  - 视频：20MB 限制（建议 <10MB）
- 实时错误提示

### localStorage 配额处理
- 捕获 QuotaExceededError 错误
- 大视频文件上传前警告用户
- 存储失败时提供选项：
  - 不保存视频继续创建项目
  - 取消创建并提示清理存储
- 友好的错误提示

### UI/UX 改进
- 拖拽上传区域，提升用户体验
- 实时预览，所见即所得
- 一键删除，方便重新选择
- 统一的黄色主题（#FFD700）

## 使用说明

### 创建项目时上传文件

1. 访问"创建新项目"页面
2. 填写项目基本信息（标题、描述、分类、目标时长）
3. 在"项目封面图片"区域：
   - 点击"点击上传"或直接拖拽图片文件
   - 查看预览，确认无误
   - 如需更换，点击"删除"按钮重新上传
4. （可选）在"项目视频"区域：
   - 点击"点击上传"或直接拖拽视频文件
   - 播放预览，确认无误
   - 如需更换，点击"删除"按钮重新上传
5. 填写其他信息后，点击"创建项目"

### 查看项目媒体

- **首页**: 浏览项目列表时，每个项目卡片会显示封面图片
- **详情页**: 点击项目进入详情页，顶部会显示视频（如有）或封面图片

## 需求文档更新

已更新 `.kiro/specs/ai-video-collaboration-platform/requirements.md` 中的需求1，新增以下验收标准：

3. WHEN 项目发起人上传封面图片 THEN 系统 SHALL 验证图片格式为JPG、PNG或GIF且文件大小不超过5MB
4. WHEN 项目发起人上传视频文件 THEN 系统 SHALL 验证视频格式为MP4、MOV或AVI且文件大小不超过100MB
5. WHEN 图片或视频上传成功 THEN 系统 SHALL 将文件转换为Base64格式存储在localStorage中

## 注意事项

⚠️ **localStorage 限制**: 
- 大多数浏览器的 localStorage 限制为 5-10MB
- 系统已实现图片自动压缩以节省空间
- 视频文件建议控制在 10MB 以内
- 超出配额时会提供友好的错误处理
- 建议在生产环境中使用云存储服务（如 AWS S3、阿里云 OSS）

⚠️ **性能考虑**:
- Base64 编码会增加约 33% 的文件大小
- 图片已自动压缩至合理尺寸（最大 1200px）
- 大量项目可能会影响页面加载速度
- 建议实施分页和懒加载

✅ **已实现的优化**:
- 图片自动压缩（最大 1200px，质量 0.7）
- 大文件上传前警告
- localStorage 配额错误捕获和处理
- 存储失败时的备选方案

## 后续优化建议

1. **云存储集成**: 将文件上传到云存储服务，只在 localStorage 中存储 URL
2. **图片压缩**: 在上传前自动压缩图片以减小文件大小
3. **视频缩略图**: 自动生成视频缩略图作为封面
4. **进度条**: 为大文件上传添加进度指示器
5. **批量上传**: 支持上传多个图片或视频
6. **编辑功能**: 允许项目发起人在项目创建后更新媒体文件

## 测试建议

1. 测试不同格式的图片和视频文件
2. 测试超过大小限制的文件
3. 测试不支持的文件格式
4. 测试删除和重新上传功能
5. 测试在不同浏览器中的兼容性
6. 测试 localStorage 空间不足的情况

## 相关文件

- `beehive-platform/src/app/projects/new/page.tsx` - 项目创建页面
- `beehive-platform/src/app/projects/[id]/page.tsx` - 项目详情页面
- `beehive-platform/src/app/page.tsx` - 首页项目列表
- `.kiro/specs/ai-video-collaboration-platform/requirements.md` - 需求文档
