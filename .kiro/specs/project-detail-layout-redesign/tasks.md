# 实现计划: 项目详情页布局重构

## 概述

本实现计划将项目详情页的布局重构分解为一系列增量式的编码任务。重构的核心是创建MediaCarousel组件整合媒体内容，提取ProgressSidebar组件，并重新组织页面布局以实现桌面端双栏和移动端单栏的响应式设计。

## 任务

- [x] 1. 创建MediaCarousel组件
  - 创建新文件 `src/components/MediaCarousel.tsx`
  - 实现标签页切换逻辑（封面图/视频）
  - 集成InlineEditFile组件用于编辑功能
  - 根据是否有视频文件设置默认标签页
  - 添加标签页切换的UI（按钮或标签）
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.6_

- [ ]* 1.1 为MediaCarousel编写属性测试
  - **属性 2: 媒体轮播默认标签页**
  - **属性 3: 媒体区域整合**
  - **验证需求: 2.1, 2.2, 2.3, 2.4, 2.5**

- [x] 2. 创建ProgressSidebar组件
  - 创建新文件 `src/components/ProgressSidebar.tsx`
  - 实现进度卡片：显示当前时长、目标时长、进度条
  - 实现任务完成统计显示
  - 实现成就数量显示
  - 实现Telegram群组链接卡片
  - 集成InlineEditNumber和InlineEditText组件
  - 添加sticky定位样式（仅桌面端）
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9_

- [ ]* 2.1 为ProgressSidebar编写属性测试
  - **属性 4: 侧边栏内容完整性**
  - **属性 5: 桌面端侧边栏定位**
  - **验证需求: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8**

- [x] 3. 重构页面顶部区域
  - 在 `src/app/projects/[id]/page.tsx` 中重新组织顶部区域
  - 将分类、标题、创建者信息整合到一个卡片中
  - 确保按照"分类 → 标题 → 创建者信息"的顺序排列
  - 保留管理员删除按钮（条件渲染）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ]* 3.1 为顶部区域编写单元测试
  - 测试元素顺序
  - 测试卡片容器结构
  - 测试管理员权限显示
  - _需求: 1.1, 1.2, 1.3, 1.5_

- [x] 4. 集成MediaCarousel到页面
  - 在项目详情页中导入MediaCarousel组件
  - 移除原有的独立封面图和视频展示代码
  - 将MediaCarousel放置在顶部区域下方
  - 传递coverImage、videoFile和编辑回调函数
  - 移除未使用的mediaTab和setMediaTab状态
  - _需求: 2.5_

- [x] 5. 实现响应式双栏布局
  - 创建flex容器，使用 `flex-col lg:flex-row` 实现响应式
  - 在移动端（lg以下）显示侧边栏：放在媒体区域下方
  - 在桌面端（lg及以上）显示侧边栏：放在右侧，固定宽度320px
  - 主内容区使用 `flex-1` 占据剩余空间
  - 设置合适的gap间距
  - _需求: 3.1, 4.1, 5.1, 5.2, 5.3, 5.4_

- [ ]* 5.1 为响应式布局编写属性测试
  - **属性 11: 移动端布局切换**
  - **验证需求: 5.1, 5.2, 5.3, 5.4**

- [x] 6. 集成ProgressSidebar到页面
  - 在项目详情页中导入ProgressSidebar组件
  - 移除原有的侧边栏代码
  - 在移动端和桌面端的正确位置渲染ProgressSidebar
  - 传递project、tasks、achievementsCount等props
  - 传递handleFieldSave回调函数
  - _需求: 3.1, 5.2_

- [x] 7. 重新组织主内容区域
  - 确保主内容区包含：描述、任务、成就、动态四个卡片
  - 验证卡片顺序正确
  - 确保每个卡片使用独立的card容器
  - 保留所有现有功能（创建任务、发布动态等）
  - _需求: 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [ ]* 7.1 为主内容区域编写属性测试
  - **属性 6: 主内容区域顺序**
  - **属性 7: 任务列表渲染**
  - **属性 8: 成就列表条件渲染**
  - **属性 9: 项目动态时间排序**
  - **验证需求: 4.1, 4.2, 4.3, 4.5, 4.6, 4.7**

- [x] 8. 添加渐进式动画效果
  - 为各个卡片添加 `animate-fade-up` 类
  - 为不同卡片设置不同的延迟（delay-1, delay-2, delay-3）
  - 确保动画效果流畅自然
  - _需求: 6.2_

- [x] 9. 检查点 - 功能验证
  - 在浏览器中测试桌面端布局
  - 在浏览器中测试移动端布局（使用开发者工具）
  - 验证所有内联编辑功能正常工作
  - 验证媒体轮播切换功能
  - 验证响应式布局切换
  - 确保所有测试通过，如有问题请询问用户

- [ ]* 10. 编写综合属性测试
  - [ ]* 10.1 编写属性测试：顶部区域完整性
    - **属性 1: 顶部区域完整性**
    - **验证需求: 1.1, 1.2, 1.3**
  
  - [ ]* 10.2 编写属性测试：编辑权限控制
    - **属性 10: 编辑权限控制**
    - **验证需求: 1.4, 1.5, 2.6, 3.9, 4.8, 7.1**
  
  - [ ]* 10.3 编写属性测试：视觉一致性
    - **属性 12: 视觉一致性**
    - **验证需求: 6.1, 6.2, 6.3**
  
  - [ ]* 10.4 编写属性测试：保存验证和反馈
    - **属性 13: 保存验证和反馈**
    - **验证需求: 7.3**
  
  - [ ]* 10.5 编写属性测试：加载状态显示
    - **属性 14: 加载状态显示**
    - **验证需求: 8.1, 8.5**

- [x] 11. 代码清理和优化
  - 移除未使用的导入和变量
  - 修复TypeScript类型错误
  - 优化组件性能（使用React.memo如需要）
  - 添加必要的代码注释（中文）
  - 确保代码符合项目的代码规范

- [x] 12. 最终检查点
  - 运行所有测试确保通过
  - 在多个浏览器中测试（Chrome、Firefox、Safari）
  - 测试不同屏幕尺寸下的表现
  - 验证所有需求都已实现
  - 如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的测试任务，可以跳过以加快MVP开发
- 每个任务都引用了具体的需求编号以便追溯
- 检查点任务确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况
